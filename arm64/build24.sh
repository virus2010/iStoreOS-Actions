#!/bin/bash
# Ê≠§ËÑöÊú¨Âú®Imagebuilder Ê†πÁõÆÂΩïËøêË°å
source custom-packages.sh
echo "Á¨¨‰∏âÊñπËΩØ‰ª∂ÂåÖ: $CUSTOM_PACKAGES"
LOGFILE="/tmp/uci-defaults-log.txt"
echo "Starting 99-custom.sh at $(date)" >> $LOGFILE

if [ -z "$CUSTOM_PACKAGES" ]; then
  echo "‚ö™Ô∏è Êú™ÈÄâÊã© ‰ªª‰ΩïÁ¨¨‰∏âÊñπËΩØ‰ª∂ÂåÖ"
else
  # ============= ÂêåÊ≠•Á¨¨‰∏âÊñπÊèí‰ª∂Â∫ì==============
  # ÂêåÊ≠•Á¨¨‰∏âÊñπËΩØ‰ª∂‰ªìÂ∫ìrun/ipk
  echo "üîÑ Ê≠£Âú®ÂêåÊ≠•Á¨¨‰∏âÊñπËΩØ‰ª∂‰ªìÂ∫ì Cloning run file repo..."
  git clone --depth=1 https://github.com/wukongdaily/store.git /tmp/store-run-repo

  # Êã∑Ë¥ù run/arm64 ‰∏ãÊâÄÊúâ run Êñá‰ª∂ÂíåipkÊñá‰ª∂ Âà∞ extra-packages ÁõÆÂΩï
  mkdir -p extra-packages
  cp -r /tmp/store-run-repo/run/arm64/* extra-packages/

  echo "‚úÖ Run files copied to extra-packages:"
  ls -lh extra-packages/*.run
  # Ëß£ÂéãÂπ∂Êã∑Ë¥ùipkÂà∞packagesÁõÆÂΩï
  sh prepare-packages.sh
  echo "ÊâìÂç∞imagebuilder/packagesÁõÆÂΩïÁªìÊûÑ"
  ls -lah packages/ |grep partexp
fi

# ËæìÂá∫Ë∞ÉËØï‰ø°ÊÅØ
echo "$(date '+%Y-%m-%d %H:%M:%S') - ÂºÄÂßãÊûÑÂª∫Âõ∫‰ª∂..."

# ============= iStoreOS 24.10 ÂÆòÊñπÈõÜÊàêÊèí‰ª∂===================
# ============= Ëã•ÂêØÁî® ÂàôÊâìÂºÄÊ≥®Èáä ============================

# ÂÆö‰πâÂàùÂßãÂåñÂèòÈáè
PACKAGES=""

# iStoreOSÂÆòÊñπÈõÜÊàêÂàóË°®ÔºåËã•ÂêØÁî®ÂàôÊâìÂºÄÊ≥®Èáä
#PACKAGES="$PACKAGES adb"
#PACKAGES="$PACKAGES adb-enablemodem"
# --------------------------------------------------------
# Ê†∏ÂøÉÂü∫Á°Ä (ÂøÖÈ°ª‰øùÁïô)
# --------------------------------------------------------
PACKAGES="$PACKAGES attr"
PACKAGES="$PACKAGES base-files"
PACKAGES="$PACKAGES bash"
PACKAGES="$PACKAGES busybox"
PACKAGES="$PACKAGES bzip2"
PACKAGES="$PACKAGES ca-bundle"
PACKAGES="$PACKAGES ca-certificates"
PACKAGES="$PACKAGES cgi-io"
PACKAGES="$PACKAGES coreutils"
PACKAGES="$PACKAGES coreutils-stat"
PACKAGES="$PACKAGES coreutils-stty"
PACKAGES="$PACKAGES curl"
PACKAGES="$PACKAGES dropbear"
PACKAGES="$PACKAGES e2fsprogs"
PACKAGES="$PACKAGES ethtool"
PACKAGES="$PACKAGES fstools"
PACKAGES="$PACKAGES fwtool"
PACKAGES="$PACKAGES getrandom"
PACKAGES="$PACKAGES htop"
PACKAGES="$PACKAGES ip-full"
PACKAGES="$PACKAGES iptables-mod-conntrack-extra"
PACKAGES="$PACKAGES iptables-mod-extra"
PACKAGES="$PACKAGES iptables-nft"
PACKAGES="$PACKAGES istoreos-files"
PACKAGES="$PACKAGES jshn"
PACKAGES="$PACKAGES jsonfilter"
PACKAGES="$PACKAGES kernel"
PACKAGES="$PACKAGES logd"
PACKAGES="$PACKAGES lsblk"
PACKAGES="$PACKAGES lscpu"
PACKAGES="$PACKAGES lua"
PACKAGES="$PACKAGES map"
PACKAGES="$PACKAGES mount-utils"
PACKAGES="$PACKAGES mtd"
PACKAGES="$PACKAGES netifd"
PACKAGES="$PACKAGES nftables-json"
PACKAGES="$PACKAGES openssl-util"
PACKAGES="$PACKAGES openwrt-keyring"
PACKAGES="$PACKAGES opkg"
PACKAGES="$PACKAGES procd"
PACKAGES="$PACKAGES procd-seccomp"
PACKAGES="$PACKAGES procd-ujail"
PACKAGES="$PACKAGES procps-ng"
PACKAGES="$PACKAGES procps-ng-vmstat"
PACKAGES="$PACKAGES resolveip"
PACKAGES="$PACKAGES rpcd"
PACKAGES="$PACKAGES rpcd-mod-file"
PACKAGES="$PACKAGES rpcd-mod-luci"
PACKAGES="$PACKAGES rpcd-mod-rrdns"
PACKAGES="$PACKAGES rpcd-mod-ucode"
PACKAGES="$PACKAGES script-utils"
PACKAGES="$PACKAGES shadow"
PACKAGES="$PACKAGES shadow-chage"
PACKAGES="$PACKAGES shadow-chfn"
PACKAGES="$PACKAGES shadow-chgpasswd"
PACKAGES="$PACKAGES shadow-chpasswd"
PACKAGES="$PACKAGES shadow-chsh"
PACKAGES="$PACKAGES shadow-common"
PACKAGES="$PACKAGES shadow-expiry"
PACKAGES="$PACKAGES shadow-faillog"
PACKAGES="$PACKAGES shadow-gpasswd"
PACKAGES="$PACKAGES shadow-groupadd"
PACKAGES="$PACKAGES shadow-groupdel"
PACKAGES="$PACKAGES shadow-groupmems"
PACKAGES="$PACKAGES shadow-groupmod"
PACKAGES="$PACKAGES shadow-groups"
PACKAGES="$PACKAGES shadow-grpck"
PACKAGES="$PACKAGES shadow-grpconv"
PACKAGES="$PACKAGES shadow-grpunconv"
PACKAGES="$PACKAGES shadow-lastlog"
PACKAGES="$PACKAGES shadow-login"
PACKAGES="$PACKAGES shadow-logoutd"
PACKAGES="$PACKAGES shadow-newgidmap"
PACKAGES="$PACKAGES shadow-newgrp"
PACKAGES="$PACKAGES shadow-newuidmap"
PACKAGES="$PACKAGES shadow-newusers"
PACKAGES="$PACKAGES shadow-nologin"
PACKAGES="$PACKAGES shadow-passwd"
PACKAGES="$PACKAGES shadow-pwck"
PACKAGES="$PACKAGES shadow-pwconv"
PACKAGES="$PACKAGES shadow-pwunconv"
PACKAGES="$PACKAGES shadow-su"
PACKAGES="$PACKAGES shadow-useradd"
PACKAGES="$PACKAGES shadow-userdel"
PACKAGES="$PACKAGES shadow-usermod"
PACKAGES="$PACKAGES shadow-utils"
PACKAGES="$PACKAGES shadow-vipw"
PACKAGES="$PACKAGES swap-utils"
PACKAGES="$PACKAGES sysfsutils"
PACKAGES="$PACKAGES sysstat"
PACKAGES="$PACKAGES tar"
PACKAGES="$PACKAGES terminfo"
PACKAGES="$PACKAGES ubox"
PACKAGES="$PACKAGES ubus"
PACKAGES="$PACKAGES ubusd"
PACKAGES="$PACKAGES uci"
PACKAGES="$PACKAGES uclient-fetch"
PACKAGES="$PACKAGES ucode"
PACKAGES="$PACKAGES ucode-mod-fs"
PACKAGES="$PACKAGES ucode-mod-html"
PACKAGES="$PACKAGES ucode-mod-lua"
PACKAGES="$PACKAGES ucode-mod-math"
PACKAGES="$PACKAGES ucode-mod-ubus"
PACKAGES="$PACKAGES ucode-mod-uci"
PACKAGES="$PACKAGES ucode-mod-uloop"
PACKAGES="$PACKAGES uhttpd"
PACKAGES="$PACKAGES uhttpd-mod-ubus"
PACKAGES="$PACKAGES unzip"
PACKAGES="$PACKAGES urandom-seed"
PACKAGES="$PACKAGES urngd"
PACKAGES="$PACKAGES usign"
PACKAGES="$PACKAGES wget-ssl"
PACKAGES="$PACKAGES xtables-nft"
PACKAGES="$PACKAGES xz"
PACKAGES="$PACKAGES xz-utils"
PACKAGES="$PACKAGES zlib"
PACKAGES="$PACKAGES zram-swap"
PACKAGES="$PACKAGES -libustream-mbedtls"

# --------------------------------------------------------
# Ê†∏ÂøÉ‰æùËµñ‰øÆÂ§çÂåÖ (Ëß£ÂÜ≥Error )
# --------------------------------------------------------
PACKAGES="$PACKAGES -dnsmasq"         # Á°Æ‰øùÁßªÈô§ÂÜ≤Á™ÅÁöÑ dnsmasq Âü∫Á°ÄÁâà (Â¶ÇÊûúÂ≠òÂú®)
PACKAGES="$PACKAGES libiptext6-0"     # IPv6 Ê†∏ÂøÉÂ∫ìÔºàÂç≥‰Ωø‰∏çÁî®ÔºåÁºñËØëÊó∂‰πüÂèØËÉΩË¢´‰æùËµñÔºâ
PACKAGES="$PACKAGES libiptext-nft0"   # Netfilter/NFTables Ê†∏ÂøÉ IP ÊñáÊú¨Â∫ì
PACKAGES="$PACKAGES libiptext0"       # Netfilter/NFTables Ê†∏ÂøÉ IP ÊñáÊú¨Â∫ì
PACKAGES="$PACKAGES liblua5.1.5"      # Ê†∏ÂøÉ Lua ËøêË°åÊó∂Â∫ì
PACKAGES="$PACKAGES libubus-lua"      # UBUS (OpenWrt ËøõÁ®ãÈÄö‰ø°) ÁöÑ Lua ÁªëÂÆö
PACKAGES="$PACKAGES libuci-lua"       # UCI (OpenWrt ÈÖçÁΩÆÁ≥ªÁªü) ÁöÑ Lua ÁªëÂÆö
PACKAGES="$PACKAGES ubus"             # UBUS ÂÆàÊä§Á®ãÂ∫è (Ê†∏ÂøÉËøõÁ®ãÈÄö‰ø°)
PACKAGES="$PACKAGES libiwinfo-lua"    # LuCI ÁïåÈù¢Êü•ËØ¢‰ø°ÊÅØÊâÄÈúÄÁöÑ Lua ÁªëÂÆö
PACKAGES="$PACKAGES luci-proto-ipv6"  # ‰øÆÂ§ç LuCI ÁΩëÁªúÈÖçÁΩÆÈ°µÈù¢ÁöÑ‰æùËµñÈìæÔºàÂç≥‰Ωø‰∏çÁî®ÔºåLuCI ‰πü‰æùËµñÔºâ
PACKAGES="$PACKAGES coreutils-nohup"  # ‰øÆÂ§ç netspeedtest ‰æùËµñ
PACKAGES="$PACKAGES kmod-crypto-core" # Ê†∏ÂøÉÂä†ÂØÜÊ®°Âùó (‰øÆÂ§ç kmod-crypto-core Áº∫Â§±)
PACKAGES="$PACKAGES kmod-nf-core"     # Ê†∏ÂøÉÈò≤ÁÅ´Â¢ôÊ®°Âùó (‰øÆÂ§ç kmod-nf-core Áº∫Â§±)

# --------------------------------------------------------
# Ê†∏ÂøÉÈ©±Âä®Ê®°Âùó (RK3566 Âíå RTL8211F ÂøÖÈ°ª‰øùÁïô)
# --------------------------------------------------------
PACKAGES="$PACKAGES kmod-block2mtd"
PACKAGES="$PACKAGES kmod-crypto-aead"
PACKAGES="$PACKAGES kmod-crypto-authenc"
PACKAGES="$PACKAGES kmod-crypto-cbc"
PACKAGES="$PACKAGES kmod-crypto-cmac"
PACKAGES="$PACKAGES kmod-crypto-core"
PACKAGES="$PACKAGES kmod-crypto-crc32c"
PACKAGES="$PACKAGES kmod-crypto-ctr"
PACKAGES="$PACKAGES kmod-crypto-deflate"
PACKAGES="$PACKAGES kmod-crypto-des"
PACKAGES="$PACKAGES kmod-crypto-ecb"
PACKAGES="$PACKAGES kmod-crypto-echainiv"
PACKAGES="$PACKAGES kmod-crypto-geniv"
PACKAGES="$PACKAGES kmod-crypto-hash"
PACKAGES="$PACKAGES kmod-crypto-hmac"
PACKAGES="$PACKAGES kmod-crypto-manager"
PACKAGES="$PACKAGES kmod-crypto-md5"
PACKAGES="$PACKAGES kmod-crypto-null"
PACKAGES="$PACKAGES kmod-crypto-rng"
PACKAGES="$PACKAGES kmod-crypto-sha1"
PACKAGES="$PACKAGES kmod-crypto-sha256"
PACKAGES="$PACKAGES kmod-dm"
PACKAGES="$PACKAGES kmod-dnsresolver"
PACKAGES="$PACKAGES kmod-dma-buf"
PACKAGES="$PACKAGES kmod-dwmac-rockchip"  # RK3566 ‰ª•Â§™ÁΩë MAC È©±Âä®
PACKAGES="$PACKAGES kmod-fs-ext4"        # Ê†∏ÂøÉÊñá‰ª∂Á≥ªÁªü
PACKAGES="$PACKAGES kmod-fs-vfat"        # Âü∫Á°ÄÊñá‰ª∂Á≥ªÁªü
PACKAGES="$PACKAGES kmod-fuse"
PACKAGES="$PACKAGES kmod-lib-crc-ccitt"
PACKAGES="$PACKAGES kmod-lib-crc-itu-t"
PACKAGES="$PACKAGES kmod-lib-crc16"
PACKAGES="$PACKAGES kmod-lib-crc32c"
PACKAGES="$PACKAGES kmod-lib-crc7"
PACKAGES="$PACKAGES kmod-lib-crc8"
PACKAGES="$PACKAGES kmod-lib-lzo"
PACKAGES="$PACKAGES kmod-lib-textsearch"
PACKAGES="$PACKAGES kmod-lib-xor"
PACKAGES="$PACKAGES kmod-lib-xxhash"
PACKAGES="$PACKAGES kmod-lib-zlib-deflate"
PACKAGES="$PACKAGES kmod-lib-zlib-inflate"
PACKAGES="$PACKAGES kmod-libphy"
PACKAGES="$PACKAGES kmod-loop"
PACKAGES="$PACKAGES kmod-mdio"
PACKAGES="$PACKAGES kmod-mii"
PACKAGES="$PACKAGES kmod-mmc"
PACKAGES="$PACKAGES kmod-nf-conntrack"
PACKAGES="$PACKAGES kmod-nf-core"
PACKAGES="$PACKAGES kmod-nf-flow"
PACKAGES="$PACKAGES kmod-nf-ipt"
PACKAGES="$PACKAGES kmod-nf-log"
PACKAGES="$PACKAGES kmod-nf-nat"
PACKAGES="$PACKAGES kmod-nf-nathelper"
PACKAGES="$PACKAGES kmod-nf-nathelper-extra"
PACKAGES="$PACKAGES kmod-nf-reject"
PACKAGES="$PACKAGES kmod-nfnetlink"
PACKAGES="$PACKAGES kmod-nft-compat"
PACKAGES="$PACKAGES kmod-nft-core"
PACKAGES="$PACKAGES kmod-nls-base"
PACKAGES="$PACKAGES kmod-nls-cp437"
PACKAGES="$PACKAGES kmod-nls-iso8859-1"
PACKAGES="$PACKAGES kmod-nls-utf8"
PACKAGES="$PACKAGES kmod-of-mdio"
PACKAGES="$PACKAGES kmod-phy-realtek"    # RTL8211F PHY È©±Âä® (ÈáçË¶Å)
PACKAGES="$PACKAGES kmod-phylink"
PACKAGES="$PACKAGES kmod-pps"
PACKAGES="$PACKAGES kmod-ptp"
PACKAGES="$PACKAGES kmod-random-core"
PACKAGES="$PACKAGES kmod-regmap-core"
PACKAGES="$PACKAGES kmod-regmap-i2c"
PACKAGES="$PACKAGES kmod-sched-core"
PACKAGES="$PACKAGES kmod-scsi-core"
PACKAGES="$PACKAGES kmod-slhc"
PACKAGES="$PACKAGES kmod-stmmac-core"
PACKAGES="$PACKAGES kmod-thermal"
PACKAGES="$PACKAGES kmod-tun"
PACKAGES="$PACKAGES kmod-usb-core"
PACKAGES="$PACKAGES kmod-usb-dwc2"
PACKAGES="$PACKAGES kmod-usb-dwc3"
PACKAGES="$PACKAGES kmod-usb-ehci"
PACKAGES="$PACKAGES kmod-usb-storage"
PACKAGES="$PACKAGES kmod-usb-xhci-hcd"
PACKAGES="$PACKAGES kmod-usb2"
PACKAGES="$PACKAGES kmod-usb3"
PACKAGES="$PACKAGES kmod-veth"

# --------------------------------------------------------
# Â∫ìÊñá‰ª∂ (ÂøÖÈ°ª‰øùÁïô)
# --------------------------------------------------------
PACKAGES="$PACKAGES libacl"
PACKAGES="$PACKAGES libatomic1"
PACKAGES="$PACKAGES libattr"
PACKAGES="$PACKAGES libblkid1"
PACKAGES="$PACKAGES libblobmsg-json20240329"
PACKAGES="$PACKAGES libbpf1"
PACKAGES="$PACKAGES libbz2-1.0"
PACKAGES="$PACKAGES libc"
PACKAGES="$PACKAGES libcap"
PACKAGES="$PACKAGES libcap-ng"
PACKAGES="$PACKAGES libcomerr0"
PACKAGES="$PACKAGES libcurl4"
PACKAGES="$PACKAGES libdbus"
PACKAGES="$PACKAGES libdevmapper"
PACKAGES="$PACKAGES libe2p2"
PACKAGES="$PACKAGES libelf1"
PACKAGES="$PACKAGES libevdev"
PACKAGES="$PACKAGES libevent2-7"
PACKAGES="$PACKAGES libexpat"
PACKAGES="$PACKAGES libext2fs2"
PACKAGES="$PACKAGES libfdisk1"
PACKAGES="$PACKAGES libffi"
PACKAGES="$PACKAGES libfuse1"
PACKAGES="$PACKAGES libgcc1"
PACKAGES="$PACKAGES libgcrypt"
PACKAGES="$PACKAGES libgdbm"
PACKAGES="$PACKAGES libgmp10"
PACKAGES="$PACKAGES libgnutls"
PACKAGES="$PACKAGES libgpg-error"
PACKAGES="$PACKAGES libiperf3"
PACKAGES="$PACKAGES libiptext-nft0"
PACKAGES="$PACKAGES libiptext0"
PACKAGES="$PACKAGES libiwinfo-data"
PACKAGES="$PACKAGES libiwinfo20230701"
PACKAGES="$PACKAGES libjson-c5"
PACKAGES="$PACKAGES libjson-script20240329"
PACKAGES="$PACKAGES libkeyutils1"
PACKAGES="$PACKAGES libkmod"
PACKAGES="$PACKAGES liblua5.1.5"
PACKAGES="$PACKAGES liblucihttp-lua"
PACKAGES="$PACKAGES liblucihttp-ucode"
PACKAGES="$PACKAGES liblucihttp0"
PACKAGES="$PACKAGES liblzma"
PACKAGES="$PACKAGES liblzo2"
PACKAGES="$PACKAGES libmbedtls21"
PACKAGES="$PACKAGES libmnl0"
PACKAGES="$PACKAGES libmount1"
PACKAGES="$PACKAGES libncurses6"
PACKAGES="$PACKAGES libneon"
PACKAGES="$PACKAGES libnetfilter-conntrack3"
PACKAGES="$PACKAGES libnettle8"
PACKAGES="$PACKAGES libnfnetlink0"
PACKAGES="$PACKAGES libnftnl11"
PACKAGES="$PACKAGES libnghttp2-14"
PACKAGES="$PACKAGES libnl-tiny1"
PACKAGES="$PACKAGES libopenssl-conf"
PACKAGES="$PACKAGES libopenssl-legacy"
PACKAGES="$PACKAGES libopenssl3"
PACKAGES="$PACKAGES libpcap1"
PACKAGES="$PACKAGES libpci"
PACKAGES="$PACKAGES libpcre2"
PACKAGES="$PACKAGES libpopt0"
PACKAGES="$PACKAGES libpthread"
PACKAGES="$PACKAGES libreadline8"
PACKAGES="$PACKAGES librt"
PACKAGES="$PACKAGES libseccomp"
PACKAGES="$PACKAGES libsensors5"
PACKAGES="$PACKAGES libsmartcols1"
PACKAGES="$PACKAGES libss2"
PACKAGES="$PACKAGES libstdcpp6"
PACKAGES="$PACKAGES libsysfs2"
PACKAGES="$PACKAGES libtasn1"
PACKAGES="$PACKAGES libtirpc"
PACKAGES="$PACKAGES libubox20240329"
PACKAGES="$PACKAGES libubus-lua"
PACKAGES="$PACKAGES libubus20250102"
PACKAGES="$PACKAGES libuci-lua"
PACKAGES="$PACKAGES libuci20250120"
PACKAGES="$PACKAGES libuclient20201210"
PACKAGES="$PACKAGES libucode20230711"
PACKAGES="$PACKAGES libudebug"
PACKAGES="$PACKAGES libudev-zero"
PACKAGES="$PACKAGES liburing"
PACKAGES="$PACKAGES libusb-1.0-0"
PACKAGES="$PACKAGES libuuid1"
PACKAGES="$PACKAGES libuv1"
PACKAGES="$PACKAGES libwebsockets-full"
PACKAGES="$PACKAGES libwrap"
PACKAGES="$PACKAGES libxtables12"
PACKAGES="$PACKAGES libzstd"

# --------------------------------------------------------
# ÊúçÂä°‰∏éÂ∫îÁî® (Ê†πÊçÆÊóÅË∑ØÁî±ÂíåiStoreOSÂäüËÉΩ‰øùÁïô)
# --------------------------------------------------------
PACKAGES="$PACKAGES avahi-dbus-daemon"
PACKAGES="$PACKAGES avahi-utils"
PACKAGES="$PACKAGES badblocks"
PACKAGES="$PACKAGES blkid"
PACKAGES="$PACKAGES block-mount"
PACKAGES="$PACKAGES btrfs-progs"
PACKAGES="$PACKAGES dbus"
PACKAGES="$PACKAGES -dnsmasq"
PACKAGES="$PACKAGES dnsmasq-full" # Ê†∏ÂøÉ DNS/DHCP ÊúçÂä°
PACKAGES="$PACKAGES firewall4"
PACKAGES="$PACKAGES fdisk"
PACKAGES="$PACKAGES grub2-efi-arm" # Áî®‰∫éÂêØÂä®
PACKAGES="$PACKAGES iperf3"
PACKAGES="$PACKAGES jansson4"
PACKAGES="$PACKAGES linkease"
PACKAGES="$PACKAGES linkmount"
PACKAGES="$PACKAGES losetup"
PACKAGES="$PACKAGES luci"
PACKAGES="$PACKAGES luci-app-argon-config"
PACKAGES="$PACKAGES luci-app-cifs-mount"
PACKAGES="$PACKAGES luci-app-cpufreq"
PACKAGES="$PACKAGES luci-app-diskman"
PACKAGES="$PACKAGES luci-app-filetransfer"
PACKAGES="$PACKAGES luci-app-firewall"
PACKAGES="$PACKAGES luci-app-linkease"
PACKAGES="$PACKAGES luci-app-mergerfs"
PACKAGES="$PACKAGES luci-app-nfs"
PACKAGES="$PACKAGES luci-app-ota"
PACKAGES="$PACKAGES luci-app-package-manager"
PACKAGES="$PACKAGES luci-app-quickstart"
PACKAGES="$PACKAGES luci-app-samba4"
PACKAGES="$PACKAGES luci-app-store"
PACKAGES="$PACKAGES luci-app-ttyd"
#PACKAGES="$PACKAGES luci-app-unishare"
PACKAGES="$PACKAGES luci-app-wol"
PACKAGES="$PACKAGES luci-base"
PACKAGES="$PACKAGES luci-compat"
PACKAGES="$PACKAGES luci-i18n-argon-config-zh-cn"
PACKAGES="$PACKAGES luci-i18n-argon-zh-cn"
PACKAGES="$PACKAGES luci-i18n-base-zh-cn"
PACKAGES="$PACKAGES luci-i18n-cifs-mount-zh-cn"
PACKAGES="$PACKAGES luci-i18n-cpufreq-zh-cn"
PACKAGES="$PACKAGES luci-i18n-diskman-zh-cn"
PACKAGES="$PACKAGES luci-i18n-filetransfer-zh-cn"
PACKAGES="$PACKAGES luci-i18n-firewall-zh-cn"
PACKAGES="$PACKAGES luci-i18n-linkease-zh-cn"
PACKAGES="$PACKAGES luci-i18n-mergerfs-zh-cn"
PACKAGES="$PACKAGES luci-i18n-nfs-zh-cn"
PACKAGES="$PACKAGES luci-i18n-ota-zh-cn"
PACKAGES="$PACKAGES luci-i18n-package-manager-zh-cn"
PACKAGES="$PACKAGES luci-i18n-quickstart-zh-cn"
PACKAGES="$PACKAGES luci-i18n-samba4-zh-cn"
PACKAGES="$PACKAGES luci-i18n-ttyd-zh-cn"
#PACKAGES="$PACKAGES luci-i18n-unishare-zh-cn"
PACKAGES="$PACKAGES luci-i18n-wol-zh-cn"
PACKAGES="$PACKAGES luci-lib-base"
PACKAGES="$PACKAGES luci-lib-fs"
PACKAGES="$PACKAGES luci-lib-ip"
PACKAGES="$PACKAGES luci-lib-ipkg"
PACKAGES="$PACKAGES luci-lib-jsonc"
PACKAGES="$PACKAGES luci-lib-nixio"
PACKAGES="$PACKAGES luci-lib-taskd"
PACKAGES="$PACKAGES luci-lib-xterm"
PACKAGES="$PACKAGES luci-light"
PACKAGES="$PACKAGES luci-lua-runtime"
PACKAGES="$PACKAGES luci-mod-admin-full"
PACKAGES="$PACKAGES luci-mod-network"
PACKAGES="$PACKAGES luci-mod-status"
PACKAGES="$PACKAGES luci-mod-system"
PACKAGES="$PACKAGES luci-proto-external"
PACKAGES="$PACKAGES luci-proto-ppp"
PACKAGES="$PACKAGES luci-ssl"
PACKAGES="$PACKAGES luci-theme-argon"
PACKAGES="$PACKAGES mdadm"
PACKAGES="$PACKAGES mergerfs"
PACKAGES="$PACKAGES miniupnpd-nftables"
PACKAGES="$PACKAGES mkf2fs"
PACKAGES="$PACKAGES nfs-kernel-server"
PACKAGES="$PACKAGES nfs-kernel-server-utils"
PACKAGES="$PACKAGES nfs-utils"
PACKAGES="$PACKAGES nfs-utils-libs"
PACKAGES="$PACKAGES ntfs3-mount"
PACKAGES="$PACKAGES ntfsprogs"
PACKAGES="$PACKAGES openssh-sftp-server"
PACKAGES="$PACKAGES parted"
PACKAGES="$PACKAGES partx-utils"
PACKAGES="$PACKAGES pciids"
PACKAGES="$PACKAGES pciutils"
PACKAGES="$PACKAGES ppp"
PACKAGES="$PACKAGES ppp-mod-pppoe"
PACKAGES="$PACKAGES proto-bonding"
PACKAGES="$PACKAGES px5g-mbedtls"
PACKAGES="$PACKAGES quickstart"
PACKAGES="$PACKAGES relayd"
PACKAGES="$PACKAGES resize2fs"
PACKAGES="$PACKAGES rpcbind"
PACKAGES="$PACKAGES samba4-libs"
PACKAGES="$PACKAGES samba4-server"
PACKAGES="$PACKAGES smartmontools"
PACKAGES="$PACKAGES taskd"
PACKAGES="$PACKAGES tcpdump"
PACKAGES="$PACKAGES tini"
PACKAGES="$PACKAGES ttyd"
PACKAGES="$PACKAGES tune2fs"
PACKAGES="$PACKAGES usbids"
PACKAGES="$PACKAGES usbutils"
PACKAGES="$PACKAGES wpa-cli"
PACKAGES="$PACKAGES wpa-supplicant-openssl"
PACKAGES="$PACKAGES wsdd2"
PACKAGES="$PACKAGES zram-swap"
PACKAGES="$PACKAGES -libustream-mbedtls"
PACKAGES="$PACKAGES -luci-app-netspeedtest"

# Âº∫Âà∂ÊéíÈô§ÊâÄÊúâÂπ≤Êâ∞È°π (ÈáçÁÇπËß£ÂÜ≥ÊÇ®ÁöÑÁºñËØëÂ§±Ë¥•ÈóÆÈ¢ò)
# --------------------------------------------------------
PACKAGES="$PACKAGES \
-rtl8192cu-firmware -rtl8192de-firmware -rtl8192se-firmware -rtl8723de-firmware -rtl8812a-firmware -rtl8821a-firmware -rtl8821ae-firmware -rtl8821ce-firmware -rtl8822be-firmware -rtl8822ce-firmware -rtl8851be-firmware -rtl8852ae-firmware -rtl8852be-firmware -rtl8852ce-firmware -rtl8922ae-firmware \
-luci-i18n-unishare-zh-cn -luci-app-netspeedtest \
-ddns-scripts -ddns-scripts-cloudflare -ddns-scripts-dnspod -ddns-scripts-services -ddns-scripts_aliyun -ddnsto -luci-app-ddns -luci-app-ddnsto \
-odhcp6c -odhcpd-ipv6only \
-kmod-vmxnet3 -kmod-bcmgenet -kmod-dwmac-sun8i -kmod-phy-smsc -kmod-phy-marvell-10g -kmod-mdio -kmod-mdio-bcm-unimac \
-kmod-ath10k -kmod-ath11k -kmod-ath12k -kmod-mt76-core -kmod-mt7915e -kmod-mt7921e \
-kmod-rtl8192cu -kmod-rtl8192de -kmod-rtw88 -kmod-rtw89 \
-bnx2x-firmware -e100-firmware -qed-firmware -mwifiex-pcie-firmware \
-r8152-firmware -r8169-firmware \
"

# Âõ∫‰ª∂ÊâìÂåÖËÑöÊú¨ÂøÖË¶Å‰æùËµñÔºåÂÖ∂‰ªñ‰æùËµñÂÆòÊñπÂàóË°®Â∑≤ÈõÜÊàê
PACKAGES="$PACKAGES perlbase-time"

# ÊñêËÆØN1Êó†Á∫øÔºöÊ≠§Âõ∫‰ª∂Êú™ËÄÉËôëÊó†Á∫øÔºåÈúÄËá™Ë°åÁ†îÁ©∂ÔºõÂÖ∂‰∏≠iwÂíåiwinfoÂÆòÊñπÂàóË°®Â∑≤ÈõÜÊàê
#PACKAGES="$PACKAGES kmod-brcmfmac wpad-basic-mbedtls"

# file/packagesÁõÆÂΩïÁöÑÁ¨¨‰∏âÊñπÂèØÈÄâÊèí‰ª∂
PACKAGES="$PACKAGES filebrowser luci-app-filebrowser-go luci-i18n-filebrowser-go-zh-cn"
PACKAGES="$PACKAGES luci-app-amlogic luci-i18n-amlogic-zh-cn"
PACKAGES="$PACKAGES lucky luci-app-lucky luci-i18n-lucky-zh-cn"
#PACKAGES="$PACKAGES openlist2 luci-app-openlist2 luci-i18n-openlist2-zh-cn"
PACKAGES="$PACKAGES luci-app-ramfree luci-i18n-ramfree-zh-cn"
#PACKAGES="$PACKAGES luci-app-adguardhome luci-i18n-adguardhome-zh-cn"

# opc-rely‰æùËµñÔºåÂÖ∂‰ªñ‰ºöËá™Âä®ÈõÜÊàê
PACKAGES="$PACKAGES ruby ruby-pstore ruby-psych ruby-yaml"

# ËøΩÂä†Ëá™ÂÆö‰πâÂåÖ
PACKAGES="$PACKAGES $CUSTOM_PACKAGES"
#PACKAGES="$PACKAGES luci-app-openclash"
#PACKAGES="$PACKAGES mosdns luci-app-mosdns luci-i18n-mosdns-zh-cn"
#PACKAGES="$PACKAGES vlmcsd luci-app-vlmcsd luci-i18n-vlmcsd-zh-cn"

# ÊûÑÂª∫ÈïúÂÉè
echo "ÂºÄÂßãÊûÑÂª∫......ÊâìÂç∞ÊâÄÊúâÂåÖÂêç===="
echo "$PACKAGES"

# ÂºÄÂßãÊûÑÂª∫
make image PROFILE=generic PACKAGES="$PACKAGES" FILES="files"

if [ $? -ne 0 ]; then
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Error: Build failed!"
    exit 1
fi

echo "$(date '+%Y-%m-%d %H:%M:%S') - ÊûÑÂª∫ÊàêÂäü."
